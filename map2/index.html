<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html style="" xmlns="http://www.w3.org/1999/xhtml"><head> 
<title>Leaflet Dynamic JSON Layer</title> 
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> 
<link rel="stylesheet" href="dyn/leaflet.css">
<link rel="stylesheet" href="dyn/style.css">
</head>
<body class="">

<div style="position:relative;float:left">
	<div tabindex="0" style="position: relative;" class="leaflet-container leaflet-fade-anim" id="map">
		<div style="transform: translate(576px, -275px);" class="leaflet-map-pane">
			<div class="leaflet-tile-pane">
			<div class="leaflet-layer">
			<div style="" class="leaflet-tile-container leaflet-zoom-animated"></div>
			<div style="" class="leaflet-tile-container leaflet-zoom-animated"></div>
		</div>
	</div>
<div class="leaflet-objects-pane">
	<div class="leaflet-shadow-pane"></div>
	<div class="leaflet-overlay-pane"></div>
	<div class="leaflet-marker-pane"></div>
	<div class="leaflet-popup-pane"></div>
</div>
</div>
<div class="leaflet-control-container">
	<div class="leaflet-top leaflet-left">
		<div class="leaflet-control-zoom leaflet-bar leaflet-control">
			<a title="Zoom in" href="#" class="leaflet-control-zoom-in">+</a>
			<a title="Zoom out" href="#" class="leaflet-control-zoom-out leaflet-disabled">-</a>
		</div>
	</div>
	<div class="leaflet-top leaflet-right"></div>
	<div class="leaflet-bottom leaflet-left"></div>
	<div class="leaflet-bottom leaflet-right">
		<div class="leaflet-control-attribution leaflet-control">
			<a href="http://leafletjs.com/" title="A JS library for interactive maps">Leaflet</a>
		</div>
	</div>
</div>
</div>
<div style="display: none;" id="loader"></div>
</div>
<script src="dyn/leaflet.js"></script>
<script src="dyn/leaflet-layerjson.js"></script>
<script>

	var map = L.map('map', {
			zoom: 10,
			minZoom:4,
			center: new L.latLng([12.790, -1.648]),
			layers: L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png')
		}),
		loader = L.DomUtil.get('loader');

	L.layerJSON({
		url: 'http://overpass-api.de/api/interpreter?data=[out:json];node({lat1},{lon1},{lat2},{lon2})[man_made=water_well];out;',
		propertyItems: 'elements',
		propertyTitle: 'tags.man_made',
		propertyLoc: ['lat','lon'],
		
		buildPopup: function(data, marker) {
			var out = '';
  			for (var p in data.tags) {
    			out += '<b>'+ p + '=</b>' + data.tags[p] + '<br/>';		
  			}
  			return ("<b>id=</b> <a target='_blank' href='//www.openstreetmap.org/node/"+data.id+"'>"+data.id+"</a><br/>"
  				+ out + '<br/>'
  				+'<b>Lat=</b>' + data.lat + '<br/>'
  				+'<b>Lon=</b>' + data.lon + '<br/>'
  				);
			//return (JSON.stringify(data, null, 4));
		},
		buildIcon: function(data, title) {
			if(data.tags['water_well:type']=='small' && data.tags['pump:manual']=='lever' && data.tags['drinking_water']=='yes'){
				var icon='img/20_hand_2.1.png';
			} else if (data.tags['water_well:type']=='small' && data.tags['pump:manual']=='pedal' && data.tags['drinking_water']=='yes'){
				var icon='img/20_pedal_2.1.png';
			} else if (data.tags['water_well:type']=='small' && data.tags['pump:manual']=='flywheel' && data.tags['drinking_water']=='yes'){
				var icon='img/20_fly_2.1.png';
			} else if (data.tags['water_well:type']=='large' && data.tags['drinking_water']=='yes'){
				var icon='img/20_large_2.1.png';
			} 


			else if (data.tags['water_well:type']=='small' && data.tags['pump:manual']=='lever' && data.tags['drinking_water']=='no'){
				var icon='img/20_hand_2.2.png';
			} else if (data.tags['water_well:type']=='small' && data.tags['pump:manual']=='pedal' && data.tags['drinking_water']=='no'){
				var icon='img/20_pedal_2.2.png';
			} else if (data.tags['water_well:type']=='small' && data.tags['pump:manual']=='flywheel' && data.tags['drinking_water']=='no'){
				var icon='img/20_fly_2.2.png';
			} else if (data.tags['water_well:type']=='large' && data.tags['drinking_water']=='no'){
				var icon='img/20_large_2.2.png';
			} 

			
			else if (data.tags['water_well:type']=='small' && data.tags['pump:manual']=='lever' && data.tags['drinking_water']=='' && data.tags['dry']=='yes'){
				var icon='img/20_hand_2.3.1.png';
			} else if (data.tags['water_well:type']=='small' && data.tags['pump:manual']=='pedal' && data.tags['drinking_water']=='' && data.tags['dry']=='yes'){
				var icon='img/20_pedal_2.3.1.png';
			} else if (data.tags['water_well:type']=='small' && data.tags['pump:manual']=='flywheel' && data.tags['drinking_water']=='' && data.tags['dry']=='yes'){
				var icon='img/20_fly_2.3.1.png';
			} else if (data.tags['water_well:type']=='large' && data.tags['drinking_water']=='' && data.tags['dry']=='yes'){
				var icon='img/20_large_2.3.1.png';
			} 


			else if (data.tags['water_well:type']=='small' && data.tags['pump:manual']=='lever' && data.tags['drinking_water']=='' ){
				var icon='img/20_hand_2.3.png';
			} else if (data.tags['water_well:type']=='small' && data.tags['pump:manual']=='pedal' && data.tags['drinking_water']==''){
				var icon='img/20_pedal_2.3.png';
			} else if (data.tags['water_well:type']=='small' && data.tags['pump:manual']=='flywheel' && data.tags['drinking_water']==''){
				var icon='img/20_fly_2.3.png';
			} else if (data.tags['water_well:type']=='large' && data.tags['drinking_water']==''){
				var icon='img/20_large_2.3.png';
			} 

			else if (data.tags['pump']=='manual'){
				var icon='img/20_pump_1.png';
			} 

			else {
				var icon='img/20_drop_1.png';
			};
			return new L.Icon({
				iconUrl: icon,
				iconSize: new L.Point(20, 20),
				iconAnchor: new L.Point(0, 0),
				popupAnchor: new L.Point(10, 0)
			});
		}
	})
	.on('dataloading',function(e) {
		loader.style.display = 'block';
	})
	.on('dataloaded',function(e) {
		loader.style.display = 'none';
	})
	.addTo(map);

</script>


</body></html>
