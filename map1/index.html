<!DOCTYPE html>
<html>
<head>
    <meta charset=utf-8 />
    <title>H2OpenMap</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <link rel="stylesheet" href="basic_stylesheet.css" type="text/css" media="all">

<script type="text/javascript">
//https://code.google.com/p/microajax/
function microAjax(B,A){this.bindFunction=function(E,D){return function(){return E.apply(D,[D])}};this.stateChange=function(D){if(this.request.readyState==4){this.callbackFunction(this.request.responseText)}};this.getRequest=function(){if(window.ActiveXObject){return new ActiveXObject("Microsoft.XMLHTTP")}else{if(window.XMLHttpRequest){return new XMLHttpRequest()}}return false};this.postBody=(arguments[2]||"");this.callbackFunction=A;this.url=B;this.request=this.getRequest();if(this.request){var C=this.request;C.onreadystatechange=this.bindFunction(this.stateChange,this);if(this.postBody!==""){C.open("POST",B,true);C.setRequestHeader("X-Requested-With","XMLHttpRequest"); C.setRequestHeader("Content-type","application/x-www-form-urlencoded");C.setRequestHeader("Connection","close")}else{C.open("GET",B,true)}C.send(this.postBody)}};
</script>

</head>
<body>
    <div id='menu'>
    <a href="../">back to H2OpenMap web site</a><span style='float:right;'></span>
    </div>
    <div id='map'></div>
    <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
    <!-- leaflet.markercluster -->
<!---->
<script src='leaflet.markercluster.js'></script>
<link href='https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/MarkerCluster.css' rel='stylesheet' />
<link href='https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/MarkerCluster.Default.css' rel='stylesheet' />
<script src='https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-hash/v0.2.1/leaflet-hash.js'></script>
<!---->
    <script >

    //creo una mappa con relativa posizione e zoom iniziali
     var map = L.map('map').setView([16.510, 5.801], 5);

    //aggiungo un layer di sfondo, o Base Layer
    var baseLayer = L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
            attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http:// mapbox.com">Mapbox</a>',
            maxZoom: 18
        }).addTo(map);

var hash = L.hash(map);

    // Icona Marker
    var singleIcon = L.icon({
        iconUrl: 'img/india32.png', // the icon for india style pumps
    //  shadowUrl: 'img/chose_one.png', // not defined yet......
        iconSize:     [20, 20], // size of the icon
        shadowSize:   [20, 20], // size of the shadow
        iconAnchor:   [0, 0], // point of the icon which will correspond to marker's location
        shadowAnchor: [0, 0],  // the same for the shadow
        popupAnchor:  [10, 20] // point from which the popup should open relative to the iconAnchor
    });

    // Oggetto marker
    /*var singleMarker = L.marker([12.6923891, -2.1997114], {
        icon:singleIcon
    })
        .bindPopup('<b>Node 3315201454</b><br>Tags:<br>access=yes<br>drinking_water=yes<br>man_made=water_well<br>pump=manual<br>source=Rasmata Onlus<br><br>Coordinates:<br>12.6923891  -2.1997114 (lat,lon)')
        .openPopup()
        .addTo(map)
    */

    // Icona GeoJSON
    var wwIcon1 = L.icon ({
        iconUrl: 'img/new_icons/32_tap_2.1.png',
    //  shadowUrl: 'img/chose_one.png', // not defined yet......
        iconSize:     [20, 20], // size of the icon
        shadowSize:   [20, 20], // size of the shadow
        iconAnchor:   [0, 0 ], // point of the icon which will correspond to marker's location
        shadowAnchor: [0, 0],  // the same for the shadow
        popupAnchor:  [10, 0] // point from which the popup should open relative to the iconAnchor
    });
    var wwIcon2 = L.icon ({
        iconUrl: 'img/new_icons/32_hand_2.1.png',
    //  shadowUrl: 'img/chose_one.png', // not defined yet......
        iconSize:     [20, 20], // size of the icon
        shadowSize:   [20, 20], // size of the shadow
        iconAnchor:   [0, 0 ], // point of the icon which will correspond to marker's location
        shadowAnchor: [0, 0],  // the same for the shadow
        popupAnchor:  [10, 0] // point from which the popup should open relative to the iconAnchor
    });
    var wwIcon3 = L.icon ({
        iconUrl: 'img/new_icons/32_pedal_2.1.png',
    //  shadowUrl: 'img/chose_one.png', // not defined yet......
        iconSize:     [20, 20], // size of the icon
        shadowSize:   [20, 20], // size of the shadow
        iconAnchor:   [0, 0 ], // point of the icon which will correspond to marker's location
        shadowAnchor: [0, 0],  // the same for the shadow
        popupAnchor:  [10, 0] // point from which the popup should open relative to the iconAnchor
    });
    var wwIcon4 = L.icon ({
        iconUrl: 'img/new_icons/32_fly_2.1.png',
    //  shadowUrl: 'img/chose_one.png', // not defined yet......
        iconSize:     [20, 20], // size of the icon
        shadowSize:   [20, 20], // size of the shadow
        iconAnchor:   [0, 0 ], // point of the icon which will correspond to marker's location
        shadowAnchor: [0, 0],  // the same for the shadow
        popupAnchor:  [10, 0] // point from which the popup should open relative to the iconAnchor
    });
    var wwIcon5 = L.icon ({
        iconUrl: 'img/new_icons/32_large_2.1.png',
    //  shadowUrl: 'img/chose_one.png', // not defined yet......
        iconSize:     [20, 20], // size of the icon
        shadowSize:   [20, 20], // size of the shadow
        iconAnchor:   [0, 0 ], // point of the icon which will correspond to marker's location
        shadowAnchor: [0, 0],  // the same for the shadow
        popupAnchor:  [10, 0] // point from which the popup should open relative to the iconAnchor
    });

/*
var propertiesToShow=['@id' ,'man_made','pump','condition','disused','abandoned',
       'access','operator','operator:type','name','fixme','water_well:type','top_type','manual_pump:type','image','ele','grid_proximity',
       'is_in:district','is_in:region','operational_status','pipe_connection','seasonal','source_date','source_ele','water_wells:source_type'];
*/

var propertiesToShow=['@id'];


var markers = new L.MarkerClusterGroup();

microAjax('data/water_well_west_africa.geojson',function (res) { 
var water_well=JSON.parse(res);
    // Dati GeoJSON

water_well.features.forEach(function(well)
{
            var text="";
            //console.log(well);
            lat = well.geometry.coordinates[0];
            lng = well.geometry.coordinates[1];
            id = well.id;

            for (var properties in well.properties){
                if (propertiesToShow.indexOf(properties)!==-1) continue;
                text+="<b>"+properties+"=</b> "+well.properties[properties]+"<br/>";
            }
            var mrkr= L.marker([lng,lat], {icon: wwIcon2}).bindPopup(
                "<b>id=</b> <a target='_blank' href='//www.openstreetmap.org/"+id+"'>"+id+"</a><br>"+text
                );
        mrkr.addTo(markers);
        });
map.addLayer(markers);
});

      // Mapbox Streets
//---------------
var mapboxTilesStreet = L.tileLayer('https://{s}.tiles.mapbox.com/v3/examples.map-i86nkdio/{z}/{x}/{y}.png', {
        attribution: '<a href="http://www.mapbox.com/about/maps/" target="_blank">Terms &amp; Feedback</a>'
    })

// Mapbox Satellite
// ---------------
var mapboxTilesSatellite = L.tileLayer('https://{s}.tiles.mapbox.com/v3/examples.map-igb471ik/{z}/{x}/{y}.png', {
        attribution: '<a href="http://www.mapbox.com/about/maps/" target="_blank">Terms &amp; Feedback</a>'
    }); 

// Creo due oggetti con i riferimenti rispettivamente ai BaseLayers ed ai FeatureLayers
    var baseMaps={
        "Sfondo OSM": baseLayer,
        "Sfondo Mapbox Streets": mapboxTilesStreet,
        "Sfondo Mapbox Satellite": mapboxTilesSatellite
    };
    var featureLayers={
        "water well": markers,
        //"water well Nanoro" : singleMarker
    };
    // Creo i controlli
    L.control.layers(baseMaps, featureLayers).addTo(map);
    // Per un metodo moolto più succinto (che usa però Mapbox.js) guardare questo link: https://www.mapbox.com/mapbox.js/example/v1.0.0/toggle-baslayers/

    </script>

</body>
</html>
